# This is the global section, where general settings are placed
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    # This section should include all HTTP-related configurations

    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Log settings
    access_log /var/log/nginx/access.log;

    # The server block goes inside the http section
    server {
        listen 80;
        server_name autoshiftnew.fly.dev;

        # Redirect all HTTP traffic to HTTPS
        return 301 https://$host$request_uri;
    }

    # The HTTPS server block
    server {
        listen 443 ssl;
        server_name autoshiftnew.fly.dev;

        # Fly.io automatically handles SSL termination, so no need for ssl_certificate or ssl_certificate_key here
        # SSL certificates are handled by Fly.io

        # Basic security headers (optional but recommended)
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-Frame-Options "DENY" always;
        add_header X-XSS-Protection "1; mode=block" always;

        # Path to your app files (ensure this points to the right location)
        root /app;  # Adjust this path as needed for your app

        # Handle routing for Single Page Apps (SPA)
        location / {
            try_files $uri $uri/ /index.html;  # For Vue.js or other SPAs
        }
    }
}
