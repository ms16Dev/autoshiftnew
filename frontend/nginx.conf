# This listens on port 80 (HTTP) for incoming requests, but Fly.io automatically redirects HTTP to HTTPS
server {
    listen 80;
    server_name autoshiftnew.fly.dev;

    # Redirect all HTTP traffic to HTTPS (even though Fly.io does this automatically, we add this as an extra measure)
    return 301 https://$host$request_uri;
}

# This is the HTTPS server block, which Fly.io automatically handles TLS termination for
server {
    listen 443 ssl;
    server_name autoshiftnew.fly.dev;

    # No need for custom certificates since Fly.io handles this automatically
    # ssl_certificate /etc/ssl/certs/ssl-cert-snakeoil.pem;
    # ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;

    # Basic security headers (optional but recommended)
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Path to your app files
    root /app;  # Make sure this is the correct path to where your app is built and located

    # Handle routing (for example, for a Vue.js app)
    location / {
        try_files $uri $uri/ /index.html;  # Use this for Vue.js or Single Page Apps
    }
}
